/*!
 * EventEmitter v4.2.8 - git.io/ee
 * Oliver Caldwell
 * MIT license
 * @preserve
 */

/**
   * To Title Case 2.1 - http://individed.com/code/to-title-case/
   * Copyright 2008-2013 David Gouch. Licensed under the MIT License.
   * https://github.com/gouch/to-title-case
   */

(function(){function e(){}function t(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function r(e){return function(){return this[e].apply(this,arguments)}}var s=e.prototype,n=this,a=n.EventEmitter;s.getListeners=function(e){var t,r,s=this._getEvents();if(e instanceof RegExp){t={};for(r in s)s.hasOwnProperty(r)&&e.test(r)&&(t[r]=s[r])}else t=s[e]||(s[e]=[]);return t},s.flattenListeners=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(e[t].listener);return r},s.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&(t={},t[e]=r),t||r},s.addListener=function(e,r){var s,n=this.getListenersAsObject(e),a="object"==typeof r;for(s in n)n.hasOwnProperty(s)&&-1===t(n[s],r)&&n[s].push(a?r:{listener:r,once:!1});return this},s.on=r("addListener"),s.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},s.once=r("addOnceListener"),s.defineEvent=function(e){return this.getListeners(e),this},s.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},s.removeListener=function(e,r){var s,n,a=this.getListenersAsObject(e);for(n in a)a.hasOwnProperty(n)&&(s=t(a[n],r),-1!==s&&a[n].splice(s,1));return this},s.off=r("removeListener"),s.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},s.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},s.manipulateListeners=function(e,t,r){var s,n,a=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(s=r.length;s--;)a.call(this,t,r[s]);else for(s in t)t.hasOwnProperty(s)&&(n=t[s])&&("function"==typeof n?a.call(this,s,n):o.call(this,s,n));return this},s.removeEvent=function(e){var t,r=typeof e,s=this._getEvents();if("string"===r)delete s[e];else if(e instanceof RegExp)for(t in s)s.hasOwnProperty(t)&&e.test(t)&&delete s[t];else delete this._events;return this},s.removeAllListeners=r("removeEvent"),s.emitEvent=function(e,t){var r,s,n,a,o=this.getListenersAsObject(e);for(n in o)if(o.hasOwnProperty(n))for(s=o[n].length;s--;)r=o[n][s],r.once===!0&&this.removeListener(e,r.listener),a=r.listener.apply(this,t||[]),a===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},s.trigger=r("emitEvent"),s.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},s.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},s._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},s._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return n.EventEmitter=a,e},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return e}):"object"==typeof module&&module.exports?module.exports=e:this.EventEmitter=e}).call(this),function(){var e={serialize:function(e,r,s){s=s||{};var n=s.encode||t,a=[e+"="+n(r)];if(null!=s.maxAge){var o=s.maxAge-0;if(isNaN(o))throw new Error("maxAge should be a Number");a.push("Max-Age="+o)}return s.domain&&a.push("Domain="+s.domain),s.path&&a.push("Path="+s.path),s.expires&&a.push("Expires="+s.expires.toUTCString()),s.httpOnly&&a.push("HttpOnly"),s.secure&&a.push("Secure"),a.join("; ")},parse:function(e,t){t=t||{};var s={},n=e.split(/; */),a=t.decode||r;return n.forEach(function(e){var t=e.indexOf("=");if(!(0>t)){var r=e.substr(0,t).trim(),n=e.substr(++t,e.length).trim();if('"'==n[0]&&(n=n.slice(1,-1)),void 0==s[r])try{s[r]=a(n)}catch(o){s[r]=n}}}),s}},t=encodeURIComponent,r=decodeURIComponent;"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define("cookie-js/cookie",[],function(){return e}):window.cookiejs=e}(),function(e,t){"function"==typeof define&&define.amd?define("analytics",t):"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=t():e.analytics=t()}(this,function(){function e(e){var r=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;return e=t(e),e.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(e,t,s){return t>0&&t+e.length!==s.length&&e.search(r)>-1&&":"!==s.charAt(t-2)&&("-"!==s.charAt(t+e.length)||"-"===s.charAt(t-1))&&s.charAt(t-1).search(/[^\s-]/)<0?e.toLowerCase():e.substr(1).search(/[A-Z]|\../)>-1?e:e.charAt(0).toUpperCase()+e.substr(1)})}function t(e){return e.replace(/^\s+|\s+$/g,"")}function r(e){return/[^@]+@[^@]+/.test(e)}function s(e){console.warn("[analytics] "+e)}function n(e){if("function"==typeof ga){var t={hitType:"event",eventCategory:c,eventAction:e.action};e.label&&(t.eventLabel=e.label),(e.value||0===e.value)&&(t.eventValue=e.value),e.nonInteraction===!0&&(t.nonInteraction=1),ga("send",t)}var r=["_trackEvent",c,e.action];e.label&&(r[3]=e.label),(e.value||0===e.value)&&(r[4]=e.value),e.nonInteraction===!0&&(r[5]=!0),_gaq.push(r)}function a(a,o){o=o||{};var i={},u=o.label,d=o.value,l=o.noninteraction||o.nonInteraction;return a?(r(a)&&(s("`action` arg looks like an email address, redacting."),a=m),i.action=e(a),u&&("string"!=typeof u?s("Expected `label` arg to be a String."):(r(u)&&(s("`label` arg looks like an email address, redacting."),u=m),i.label=t(u))),(d||0===d)&&("number"!=typeof d?s("Expected `value` arg to be a Number."):i.value=0|d),l&&("boolean"!=typeof l?s("Expected `noninteraction` arg to be a Boolean."):i.nonInteraction=l===!0),void n(i)):void s("Expected `action` arg.")}function o(e){return/^\/virtual\//.test(e)?e:(e=e.replace(/^[/]?/,"/"),"/virtual"+e)}function i(e){if("function"==typeof ga){var t={hitType:"pageview",page:e.virtualPagePath};ga("send",t)}var r=["_trackPageview",e.virtualPagePath];_gaq.push(r)}function u(e){if(!e)return void s("Expected `virtualPagePath` arg.");e=t(e);var r={};r.virtualPagePath=o(e),i(r)}function d(e){var t=["trackEvent",e.action];if(e.revenue){var r={revenue:e.revenue};t[2]=r}optimizely.push(t)}function l(e,r){r=r||{};var n={},a=r.valueInCents;return e?(n.action=t(e),a&&("number"==typeof a&&a%1===0?n.revenue=a:s("Expected `valueInCents` arg to be an integer.")),void d(n)):void s("Expected `action` arg.")}this._gaq||(this._gaq=[]),this.optimizely||(this.optimizely=[]);var c=location.hostname,m="REDACTED (Potential Email Address)";return{event:a,virtualPageview:u,conversionGoal:l}}),function(e){function t(t,s,n){return function(a){e.localStorage||console.error("Local storage must be supported for instant login.");var o=this,i={domain:location.hostname.split(".").slice(-2).join("."),path:"/",secure:"https:"===location.protocol,expires:new Date(Date.now()+6048e5)},u=/ref=((?:\w|-)+)/.exec(e.location.search),d=s.parse(document.cookie).webmakerReferral;u&&(u=u[1]),a=a||{},a.paths=a.paths||{},o.emitter=new t,o.host=a.host||"",o.paths=a.paths||{},o.paths.authenticate=a.paths.authenticate||"/authenticate",o.paths.create=a.paths.create||"/create",o.paths.verify=a.paths.verify||"/verify",o.paths.logout=a.paths.logout||"/logout",o.paths.checkUsername=a.paths.checkUsername||"/check-username",o.paths.request=a.paths.request||"/auth/v2/request",o.paths.uidExists=a.paths.uidExists||"/auth/v2/uid-exists",o.paths.createUser=a.paths.createUser||"/auth/v2/create",o.paths.authenticateToken=a.paths.authenticateToken||"/auth/v2/authenticateToken",o.paths.verifyPassword=a.paths.verifyPassword||"/auth/v2/verify-password",o.paths.requestResetCode=a.paths.requestResetCode||"/auth/v2/request-reset-code",o.paths.removePassword=a.paths.removePassword||"/auth/v2/remove-password",o.paths.enablePasswords=a.paths.enablePasswords||"/auth/v2/enable-passwords",o.paths.resetPassword=a.paths.resetPassword||"/auth/v2/reset-password",o.urls={request:o.host+o.paths.request,authenticateToken:o.host+o.paths.authenticateToken,authenticate:o.host+o.paths.authenticate,create:o.host+o.paths.create,createUser:o.host+o.paths.createUser,verify:o.host+o.paths.verify,logout:o.host+o.paths.logout,uidExists:o.host+o.paths.uidExists,checkUsername:o.host+o.paths.checkUsername,verifyPassword:o.host+o.paths.verifyPassword,requestResetCode:o.host+o.paths.requestResetCode,removePassword:o.host+o.paths.removePassword,enablePasswords:o.host+o.paths.enablePasswords,resetPassword:o.host+o.paths.resetPassword},o.audience=a.audience||e.location.protocol+"//"+e.location.host,o.prefix=a.prefix||"webmaker-",o.timeout=a.timeout||10,o.localStorageKey=o.prefix+"login",o.csrfToken=a.csrfToken,o.withCredentials=a.withCredentials===!1?!1:!0,u&&d!==u&&(document.cookie=s.serialize("webmakerReferral",u,i),d=u),o.clearReferrerCookie=function(){var e=i;e.expires=new Date(Date.now()-1e4),document.cookie=s.serialize("webmakerReferral","expire",e)},o.handleNewUserUI=a.handleNewUserUI===!1?!1:!0,o.analytics={},o.analytics.webmakerNewUserCancelled=function(){n.event("Webmaker New User Cancelled")},o.modal={},o.modal.element=document.getElementById("webmaker-login-new-user"),o.modal.dismissSelector="[data-dismiss]",o.modal.createSelector=".create-user",o.modal.createBtnOnClick=function(){},o.modal.checkUsernameOnChange=function(){var e=o.modal.element.querySelector(".username-taken-error"),t=o.modal.element.querySelector(".username-invalid-error"),r=o.modal.element.querySelector(".username-required-error"),s=o.modal.element.querySelector(".username-group"),n=this.value;return n?void o.checkUsername(n,function(n,a){n&&"Username taken"===a?(s.classList.add("has-error"),s.classList.remove("has-success"),e.classList.remove("hidden"),r.classList.add("hidden"),t.classList.add("hidden")):n&&"Username invalid"===a?(s.classList.add("has-error"),s.classList.remove("has-success"),t.classList.remove("hidden"),e.classList.add("hidden"),r.classList.add("hidden")):(s.classList.remove("has-error"),s.classList.add("has-success"),e.classList.add("hidden"),r.classList.add("hidden"),t.classList.add("hidden"))}):(s.classList.remove("has-success"),s.classList.add("has-error"),e.classList.add("hidden"),r.classList.remove("hidden"),void t.classList.add("hidden"))},o.modal.setup=function(e){var t=o.modal.element.querySelector(o.modal.createSelector),r=o.modal.element.querySelectorAll(o.modal.dismissSelector),s=o.modal.element.querySelector(".username-group"),n=o.modal.element.querySelector(".agree-group"),a=o.modal.element.querySelector(".username-taken-error"),i=o.modal.element.querySelector(".username-required-error"),u=o.modal.element.querySelector(".username-invalid-error"),d=o.modal.element.querySelector(".agree-error"),l=o.modal.element.querySelector('[name="username"]'),c=o.modal.element.querySelector('[name="agreeToTerms"]'),m=o.modal.element.querySelector('[name="mailingList"]'),p=o.modal.element.querySelector("[name=supportedLocales]");t.removeEventListener("click",o.modal.createBtnOnClick,!1),l.addEventListener("change",o.modal.checkUsernameOnChange,!1),o.modal.createBtnOnClick=function(){var t=!1;c.checked||(n.classList.add("has-error"),d.classList.remove("hidden"),t=!0),l.value||(s.classList.remove("has-success"),s.classList.add("has-error"),a.classList.add("hidden"),i.classList.remove("hidden"),u.classList.add("hidden"),t=!0),t||o.checkUsername(l.value,function(t,r){t&&"Username taken"===r?(s.classList.add("has-error"),s.classList.remove("has-success"),a.classList.remove("hidden"),i.classList.add("hidden"),u.classList.add("hidden")):t&&"Username invalid"===r?(s.classList.add("has-error"),s.classList.remove("has-success"),u.classList.remove("hidden"),a.classList.add("hidden"),i.classList.add("hidden")):o.createUser({assertion:e,user:{username:l.value,mailingList:m.checked,prefLocale:p.value}},function(e){return e?void console.error(e):(a.classList.add("hidden"),i.classList.add("hidden"),u.classList.add("hidden"),d.classList.add("hidden"),s.classList.remove("has-error"),s.classList.remove("has-success"),n.classList.remove("has-error"),void o.modal.close())})})};for(var h=0;h<r.length;h++)r[h].removeEventListener("click",o.modal.close,!1),r[h].addEventListener("click",o.modal.close,!1);t.addEventListener("click",o.modal.createBtnOnClick,!1)},o.modal.open=function(){o.modal.element.classList.add("in"),o.modal.element.style.display="block",o.modal.element.setAttribute("aria-hidden",!1)},o.modal.close=function(e){e&&o.analytics.webmakerNewUserCancelled(),o.modal.element.classList.remove("in"),o.modal.element.style.display="none",o.modal.element.setAttribute("aria-hidden",!0)},o.on=function(e,t){o.emitter.addListener(e,t)},o.off=function(e,t){o.emitter.removeListener(e,t)},o.uidExists=function(e,t){var r=new XMLHttpRequest,s=JSON.stringify({uid:e});r.open("POST",o.urls.uidExists,!0),r.withCredentials=o.withCredentials,r.setRequestHeader("Content-type","application/json"),r.setRequestHeader("X-CSRF-Token",o.csrfToken),r.onreadystatechange=function(){if(4===r.readyState&&200===r.status)try{var e=JSON.parse(r.responseText);t(null,e)}catch(s){o.emitter.emitEvent("error",["could not parse response"]),t("error-checking-email")}else 4===r.readyState&&r.status&&(r.status>=400||r.status<200)?(o.emitter.emitEvent("error",[r.responseText]),t("error-checking-email")):4===r.readyState&&(o.emitter.emitEvent("error",["Looks like "+o.urls.checkEmail+" is not responding..."]),t("error-checking-email"))},r.send(s)},o.checkUsername=function(e,t){if(!r.test(e))return t(!0,"Username invalid");var s=new XMLHttpRequest,n=JSON.stringify({username:e});s.open("POST",o.urls.checkUsername,!0),s.withCredentials=o.withCredentials,s.setRequestHeader("Content-type","application/json"),s.setRequestHeader("X-CSRF-Token",o.csrfToken),s.onreadystatechange=function(){if(4===s.readyState&&200===s.status){var e=JSON.parse(s.responseText);e.exists?t(!0,"Username taken"):t(!1,"Username not taken")}else 4===s.readyState&&s.status&&(s.status>=400||s.status<200)?(o.emitter.emit("error",s.responseText),t(!1,"Error checking username")):4===s.readyState&&(o.emitter.emit("error","Looks like "+o.urls.checkUsername+" is not responding..."),t(!1,"Error checking username"))},s.send(n)},o.createNewUser=function(e,t){e.user.referrer=d;var r=new XMLHttpRequest,s=JSON.stringify({audience:o.audience,user:e.user});t=t||function(){},r.open("POST",o.urls.createUser,!0),r.withCredentials=o.withCredentials,r.setRequestHeader("Content-type","application/json"),r.setRequestHeader("X-CSRF-Token",o.csrfToken),r.onreadystatechange=function(){if(4===r.readyState&&200===r.status){var e=JSON.parse(r.responseText);e.user?(o.storage.set(e.user),o.emitter.emitEvent("login",[e.user,"user created"]),n.event("Webmaker New User Created",{nonInteraction:!0}),n.conversionGoal("WebmakerNewUserCreated"),o.clearReferrerCookie(),t(null,e.user)):(o.emitter.emitEvent("error",[r.responseText]),t(r.responseText))}else 4===r.readyState&&r.status&&(r.status>=400||r.status<200)?(o.emitter.emitEvent("error",[r.responseText]),t(r.responseText)):4===r.readyState&&(o.emitter.emitEvent("error",["Looks like "+o.urls.create+" is not responding..."]),t(r.responseText))},r.send(s)},o.createUser=function(e,t){e.user.referrer=d;var r=new XMLHttpRequest,s=JSON.stringify({assertion:e.assertion,audience:o.audience,user:e.user});t=t||function(){},r.open("POST",o.urls.create,!0),r.withCredentials=o.withCredentials,r.setRequestHeader("Content-type","application/json"),r.setRequestHeader("X-CSRF-Token",o.csrfToken),r.onreadystatechange=function(){if(4===r.readyState&&200===r.status){var e=JSON.parse(r.responseText);e.user?(o.storage.set(e.user),o.emitter.emit("login",e.user,"user created"),n.event("Webmaker New User Created",{nonInteraction:!0}),n.conversionGoal("WebmakerNewUserCreated"),o.clearReferrerCookie(),t(null,e.user)):(o.emitter.emit("error",r.responseText),t(r.responseText))}else 4===r.readyState&&r.status&&(r.status>=400||r.status<200)?(o.emitter.emit("error",r.responseText),t(r.responseText)):4===r.readyState&&(o.emitter.emit("error","Looks like "+o.urls.create+" is not responding..."),t(r.responseText))},r.send(s)},o.verify=function(){o.storage.get()&&o.emitter.emit("login",o.storage.get(),"restored");var e=o.storage.get("email"),t=new XMLHttpRequest;t.open("POST",o.urls.verify,!0),t.withCredentials=o.withCredentials,t.setRequestHeader("Content-type","application/json"),t.setRequestHeader("X-CSRF-Token",o.csrfToken),t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){var r=JSON.parse(t.responseText);e&&r.email===e?(o.emitter.emit("login",r.user,"verified"),o.storage.set(r.user)):r.user?(o.emitter.emit("login",r.user,"email mismatch"),o.storage.set(r.user)):(o.emitter.emit("logout"),o.storage.clear())}else 4===t.readyState&&t.status&&(t.status>=400||t.status<200)?o.emitter.emit("error",t.responseText):4===t.readyState&&o.emitter.emit("error","Looks like "+o.urls.verify+" is not responding...")},t.send()},o.request=function(t,r){n.event("Webmaker Request Token Clicked"),e.removeEventListener("focus",o.verify,!1);var s=new XMLHttpRequest,a=JSON.stringify({uid:t});if(o.timeout)var i=setTimeout(function(){s.abort(),o.emitter.emitEvent("error",["The request for a token timed out after "+o.timeout+" seconds"])},1e3*o.timeout);s.open("POST",o.urls.request,!0),s.withCredentials=o.withCredentials,s.setRequestHeader("Content-type","application/json"),s.setRequestHeader("X-CSRF-Token",o.csrfToken),s.onreadystatechange=function(){if(o.timeout&&i&&clearTimeout(i),4===s.readyState&&200===s.status){var e=JSON.parse(s.responseText);if(e.error||e.err)return o.emitter.emitEvent("error",[e.error||e.err]),r(e.error||e.err);if(e.status)return o.emitter.emitEvent("tokenrequested",[e.status]),n.event("Webmaker Login Token Requested"),r(null,e.status)}else{if(4===s.readyState&&s.status&&(s.status>=400||s.status<200))return o.emitter.emitEvent("error",[s.responseText]),r(s.responseText);if(4===s.readyState)return o.emitter.emitEvent("error",["Looks like "+o.urls.request+" is not responding..."]),r("no response")}},s.send(a)},o.authenticateToken=function(t,r,s,a){if(!t||!r)return void o.emitter.emitEvent("error",["missing token or uid"]);s=s||"one-year",a=a||Function.prototype,n.event("Webmaker Authenticate Token Clicked"),e.removeEventListener("focus",o.verify,!1);var i,u=new XMLHttpRequest,d=JSON.stringify({uid:t,token:r,validFor:s}),l="Looks like "+o.urls.authenticateToken+" is not responding...",c="The login request timed out after "+o.timeout+" seconds";o.timeout&&(i=setTimeout(function(){u.abort(),o.emitter.emitEvent("error",[c]),a(c)},1e3*o.timeout)),u.open("POST",o.urls.authenticateToken,!0),u.withCredentials=o.withCredentials,u.setRequestHeader("Content-type","application/json"),u.setRequestHeader("X-CSRF-Token",o.csrfToken),u.onreadystatechange=function(){if(o.timeout&&i&&clearTimeout(i),4===u.readyState&&200===u.status){var t=JSON.parse(u.responseText);if(t.error||t.err)return o.emitter.emitEvent("error",[t.error||t.err]),a(t.error||t.err);if(t.user)return o.emitter.emitEvent("tokenlogin",[t.user]),n.event("Webmaker Token Login Succeeded"),e.addEventListener("focus",o.verify,!1),a(null,t.user)}else{if(4===u.readyState&&u.status&&(u.status>=400||u.status<200))return o.emitter.emitEvent("error",[u.responseText]),a(u.responseText);4===u.readyState&&(o.emitter.emitEvent("error",[l]),a(l))}},u.send(d)},o.login=function(){return e.navigator.id?(n.event("Webmaker Login Clicked"),e.removeEventListener("focus",o.verify,!1),void e.navigator.id.get(function(t){if(!t)return o.emitter.emit("error","No assertion was received"),void n.event("Persona Login Cancelled");n.event("Persona Login Succeeded");var r={referrer:d},s=new XMLHttpRequest,a=JSON.stringify({audience:o.audience,assertion:t,user:r});if(o.timeout)var i=setTimeout(function(){s.abort(),o.emitter.emit("error","The request for a token timed out after "+o.timeout+" seconds")},1e3*o.timeout);s.open("POST",o.urls.authenticate,!0),s.withCredentials=o.withCredentials,s.setRequestHeader("Content-type","application/json"),s.setRequestHeader("X-CSRF-Token",o.csrfToken),s.onreadystatechange=function(){if(o.timeout&&i&&clearTimeout(i),4===s.readyState&&200===s.status){var r=JSON.parse(s.responseText);r.error&&o.emitter.emit("error",r.error),r.user&&(o.storage.set(r.user),o.emitter.emit("login",r.user),n.event("Webmaker Login Succeeded"),o.clearReferrerCookie(),e.addEventListener("focus",o.verify,!1)),r.email&&!r.user&&(o.emitter.emit("newuser",t,r.email),n.event("Webmaker New User Started"),o.handleNewUserUI&&(o.modal.setup(t,r.email),o.modal.open())),r.err&&o.emitter.emit("error",r.err)}else 4===s.readyState&&s.status&&(s.status>=400||s.status<200)?o.emitter.emit("error",s.responseText):4===s.readyState&&o.emitter.emit("error","Looks like "+o.urls.authenticate+" is not responding...")},s.send(a)},{backgroundColor:"#E3EAEE",privacyPolicy:"https://webmaker.org/privacy",siteLogo:"https://stuff.webmaker.org/persona-assets/logo-webmaker.png",siteName:"Mozilla Webmaker",termsOfService:"https://webmaker.org/terms"})):void console.error("No persona found. Did you include include.js?")},o.logout=function(){n.event("Webmaker Logout Clicked"),e.removeEventListener("focus",o.verify,!1);var t=new XMLHttpRequest;t.open("POST",o.urls.logout,!0),t.withCredentials=o.withCredentials,t.setRequestHeader("X-CSRF-Token",o.csrfToken),t.onreadystatechange=function(){4===t.readyState&&200===t.status?(o.emitter.emit("logout"),o.storage.clear(),e.addEventListener("focus",o.verify,!1)):4===t.readyState&&t.status&&(t.status>=400||t.status<200)?o.emitter.emit("error",t.responseText):4===t.readyState&&o.emitter.emit("error","Looks like "+o.urls.logout+" is not responding...")},t.send(null)},o.verifyPassword=function(e,t,r){var s=new XMLHttpRequest,a=JSON.stringify({uid:e,password:t});s.open("POST",o.urls.verifyPassword,!0),s.withCredentials=o.withCredentials,s.setRequestHeader("Content-type","application/json"),s.setRequestHeader("X-CSRF-Token",o.csrfToken),s.onreadystatechange=function(){if(4===s.readyState&&200===s.status){var e=JSON.parse(s.responseText);e.user?(o.emitter.emitEvent("passwordlogin",[e.user]),n.event("Webmaker User Password Login",{nonInteraction:!0}),r(null,!0)):(o.emitter.emitEvent("error",[s.responseText]),r(s.responseText))}else 4===s.readyState&&s.status&&401===s.status?(o.emitter.emitEvent("error",["unauthorized"]),r(null,!1)):4===s.readyState&&s.status&&(s.status>=400||s.status<200)?(o.emitter.emitEvent("error",[s.responseText]),r(s.responseText)):4===s.readyState&&(o.emitter.emitEvent("error",["Looks like "+o.urls.setFirstPassword+" is not responding..."]),r(s.responseText))},s.send(a)},o.requestResetCode=function(e,t){var r=new XMLHttpRequest,s=JSON.stringify({uid:e});r.open("POST",o.urls.requestResetCode,!0),r.withCredentials=o.withCredentials,r.setRequestHeader("Content-type","application/json"),r.setRequestHeader("X-CSRF-Token",o.csrfToken),r.onreadystatechange=function(){if(4===r.readyState&&200===r.status){var e=JSON.parse(r.responseText);e.status?(o.emitter.emitEvent("resetrequestgenerated"),n.event("Webmaker User Reset Password",{nonInteraction:!0}),t(null)):(o.emitter.emitEvent("error",[r.responseText]),t(r.responseText))}else 4===r.readyState&&r.status&&(r.status>=400||r.status<200)?(o.emitter.emitEvent("error",[r.responseText]),t(r.responseText)):4===r.readyState&&(o.emitter.emitEvent("error",["Looks like "+o.urls.requestReset+" is not responding..."]),t(r.responseText))},r.send(s)},o.resetPassword=function(e,t,r,s){var a=new XMLHttpRequest,i=JSON.stringify({uid:e,resetCode:t,newPassword:r});a.open("POST",o.urls.resetPassword,!0),a.withCredentials=o.withCredentials,a.setRequestHeader("Content-type","application/json"),a.setRequestHeader("X-CSRF-Token",o.csrfToken),a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){var e=JSON.parse(a.responseText);e.status?(o.emitter.emitEvent("passwordreset"),n.event("Webmaker User Reset Password",{nonInteraction:!0}),s(null)):(o.emitter.emitEvent("error",[a.responseText]),s(a.responseText))}else 4===a.readyState&&a.status&&(a.status>=400||a.status<200)?(o.emitter.emitEvent("error",[a.responseText]),s(a.responseText)):4===a.readyState&&(o.emitter.emitEvent("error",["Looks like "+o.urls.resetPassword+" is not responding..."]),s(a.responseText))},a.send(i)},o.enablePasswords=function(e,t){var r=new XMLHttpRequest,s=JSON.stringify({password:e});r.open("POST",o.urls.enablePasswords,!0),r.withCredentials=o.withCredentials,r.setRequestHeader("Content-type","application/json"),r.setRequestHeader("X-CSRF-Token",o.csrfToken),r.onreadystatechange=function(){if(4===r.readyState&&200===r.status){var e=JSON.parse(r.responseText);e.user?(o.emitter.emitEvent("passwords-enabled"),n.event("Webmaker User Enabled Passwords",{nonInteraction:!0}),t(null)):(o.emitter.emitEvent("error",[r.responseText]),t(r.responseText))}else 4===r.readyState&&r.status&&(r.status>=400||r.status<200)?(o.emitter.emitEvent("error",[r.responseText]),t(r.responseText)):4===r.readyState&&(o.emitter.emitEvent("error",["Looks like "+o.urls.requestReset+" is not responding..."]),t(r.responseText))},r.send(s)},o.removePassword=function(e){var t=new XMLHttpRequest;t.open("POST",o.urls.removePassword,!0),t.withCredentials=o.withCredentials,t.setRequestHeader("Content-type","application/json"),t.setRequestHeader("X-CSRF-Token",o.csrfToken),t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){var r=JSON.parse(t.responseText);r.user?(o.emitter.emitEvent("passwords-disabled"),n.event("Webmaker User Disabled Passwords",{nonInteraction:!0}),e(null)):(o.emitter.emitEvent("error",[t.responseText]),e(t.responseText))}else 4===t.readyState&&t.status&&(t.status>=400||t.status<200)?(o.emitter.emitEvent("error",[t.responseText]),e(t.responseText)):4===t.readyState&&(o.emitter.emitEvent("error",["Looks like "+o.urls.requestReset+" is not responding..."]),e(t.responseText))},t.send()},o.storage={get:function(e){var t=JSON.parse(localStorage.getItem(o.localStorageKey));if(t)return e?t[e]:t},set:function(e){var t=JSON.parse(localStorage.getItem(o.localStorageKey))||{};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);localStorage.setItem(o.localStorageKey,JSON.stringify(t))},clear:function(){delete localStorage[o.localStorageKey]}}}}var r=/^[abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\-]{1,20}$/;if("function"==typeof define&&define.amd)define("webmaker-auth-client",["eventEmitter/EventEmitter","cookie-js/cookie","analytics"],t);else if("object"==typeof module&&module.exports){var s=require("cookie"),n=require("events").EventEmitter,a=require("webmaker-analytics");module.exports=t(n,s,a)}else e.WebmakerAuthClient=t(e.EventEmitter,e.cookiejs,e.analytics)}(window);